var S3Client, _, crypto, mime, moment,
  indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

_ = require('lodash');

mime = require('mime');

moment = require('moment');

crypto = require('crypto');

S3Client = (function() {
  function S3Client(options, arrAllowedDataExtensions) {
    var aws;
    if (options == null) {
      options = {};
    }
    aws = require('aws-sdk');
    if (!(options instanceof aws.Config)) {
      this._checkOptions(options);
    }
    aws.config.update(options);
    this.s3 = new aws.S3();
    this.arrAllowedDataExtensions = null;
    if (arrAllowedDataExtensions && this._checkAllowedDataExtensions(arrAllowedDataExtensions)) {
      this.arrAllowedDataExtensions = arrAllowedDataExtensions;
    }
  }

  S3Client.prototype.uploadPostForm = function(options, cb) {
    var acl, algorithm, bucket, contentLength, contentType, dateKey, dateLongPolicy, dateRegionKey, dateRegionServiceKey, dateShortPolicy, expires, extension, key, policy, policyDoc, ref, ref1, ref2, ref3, ref4, ref5, region, signature, signingKey, stream;
    if (options == null) {
      options = {};
    }
    if (!cb) {
      throw new Error('Callback is required');
    }
    extension = options.extension, key = options.key, bucket = options.bucket, expires = options.expires, acl = options.acl, contentLength = options.contentLength, algorithm = options.algorithm, region = options.region;
    key = options.key;
    bucket = options.bucket;
    extension = (ref = options.extension) != null ? ref : null;
    expires = (ref1 = options.expires) != null ? ref1 : moment().add(60, 'minutes').toDate();
    acl = (ref2 = options.acl) != null ? ref2 : 'public-read';
    contentLength = (ref3 = options.contentLength) != null ? ref3 : null;
    algorithm = (ref4 = options.algorithm) != null ? ref4 : 'AWS4-HMAC-SHA256';
    region = (ref5 = options.region) != null ? ref5 : this.region;
    if (!(key && bucket)) {
      return cb(new Error('key and bucket are required'));
    }
    if (extension) {
      contentType = this._checkDataExtension(extension);
      if (!contentType) {
        return cb(new Error('Data extension not allowed'));
      }
    }
    policyDoc = {};
    if (expires && _.isDate(expires)) {
      policyDoc["expiration"] = moment(expires).format("YYYY-MM-DD[T]HH:MM:SS[Z]");
    }
    policyDoc["conditions"] = [];
    dateShortPolicy = moment().format('YYYYMMDD');
    dateLongPolicy = moment().format('YYYYMMDD[T]HHMMSS[Z]');
    policyDoc.conditions.push({
      'bucket': bucket
    });
    policyDoc.conditions.push(['starts-with', '$key', key]);
    policyDoc.conditions.push({
      'acl': acl
    });
    if (contentType) {
      policyDoc.conditions.push(['starts-with', '$Content-Type', contentType]);
    }
    if (contentLength) {
      policyDoc.conditions.push(['content-length-range', 0, contentLength]);
    }
    policyDoc.conditions.push({
      "x-amz-algorithm": algorithm
    });
    policyDoc.conditions.push({
      "x-amz-credential": this.accessKeyId + "/" + dateShortPolicy + "/" + region + "/s3/aws4_request"
    });
    policyDoc.conditions.push({
      "x-amz-date": dateLongPolicy
    });
    dateKey = crypto.createHmac('sha256', "AWS4" + this.secretAccessKey).update(dateShortPolicy).digest();
    dateRegionKey = crypto.createHmac('sha256', dateKey).update(region).digest();
    dateRegionServiceKey = crypto.createHmac('sha256', dateRegionKey).update('s3').digest();
    signingKey = crypto.createHmac('sha256', dateRegionServiceKey).update('aws4_request').digest();
    policy = new Buffer(JSON.stringify(policyDoc)).toString('base64');
    signature = crypto.createHmac('sha256', signingKey).update(policy).digest('hex');
    stream = {};
    stream['params'] = {
      "key": key,
      "acl": acl,
      "x-amz-algorithm": algorithm,
      "x-amz-credential": this.accessKeyId + "/" + dateShortPolicy + "/" + region + "/s3/aws4_request",
      "x-amz-date": dateLongPolicy,
      "policy": policy,
      "x-amz-signature": signature
    };
    if (contentType) {
      stream.params['content-type'] = contentType;
    }
    stream['public_url'] = "https://" + bucket + ".s3.amazonaws.com/" + key;
    stream['form_url'] = "https://" + bucket + ".s3.amazonaws.com/";
    return cb(null, stream);
  };

  S3Client.prototype.upload = function(options, cb) {
    var acl, bucket, contentLength, contentType, data, expires, extension, key, params, ref, ref1, ref2, ref3;
    if (options == null) {
      options = {};
    }
    if (!cb) {
      throw new Error('Callback is required');
    }
    data = options.data, extension = options.extension, key = options.key, bucket = options.bucket, expires = options.expires, acl = options.acl, contentLength = options.contentLength;
    data = options.data;
    key = options.key;
    bucket = options.bucket;
    extension = (ref = options.extension) != null ? ref : null;
    expires = (ref1 = options.expires) != null ? ref1 : null;
    acl = (ref2 = options.acl) != null ? ref2 : null;
    contentLength = (ref3 = options.contentLength) != null ? ref3 : null;
    if (!(data && key && bucket)) {
      return cb(new Error('data, key and bucket are required'));
    }
    params = {
      Bucket: bucket,
      Key: key,
      Body: data
    };
    if (extension) {
      contentType = this._checkDataExtension(extension);
      if (!contentType) {
        return cb(new Error('Data extension not allowed'));
      }
      params["ContentType"] = contentType;
    }
    if (expires && _.isDate(expires)) {
      params["Expires"] = moment(expires);
    }
    if (acl) {
      params["ACL"] = acl;
    }
    if (contentLength) {
      params["ContentLength"] = contentLength;
    }
    return this.s3.upload(params, function(err, data) {
      if (err) {
        return cb(err);
      }
      return cb(null, "https://" + bucket + ".s3.amazonaws.com/" + key);
    });
  };

  S3Client.prototype.put = function(options, cb) {
    var acl, bucket, contentLength, contentType, expires, extension, key, params, ref, ref1, ref2;
    if (options == null) {
      options = {};
    }
    if (!cb) {
      throw new Error('Callback is required');
    }
    extension = options.extension, key = options.key, bucket = options.bucket, expires = options.expires, acl = options.acl, contentLength = options.contentLength;
    key = options.key;
    bucket = options.bucket;
    extension = (ref = options.extension) != null ? ref : null;
    expires = (ref1 = options.expires) != null ? ref1 : null;
    acl = (ref2 = options.acl) != null ? ref2 : null;
    if (!(key && bucket)) {
      return cb(new Error('key and bucket are required'));
    }
    params = {
      Bucket: bucket,
      Key: key
    };
    if (extension) {
      contentType = this._checkDataExtension(extension);
      if (!contentType) {
        return cb(new Error('Data extension not allowed'));
      }
      params["ContentType"] = contentType;
    }
    if (expires && _.isDate(expires)) {
      params["Expires"] = moment(expires);
    }
    if (acl) {
      params["ACL"] = acl;
    }
    return this.s3.getSignedUrl("putObject", params, function(err, data) {
      var put;
      if (err) {
        return cb(err);
      }
      put = {
        'signed_url': data,
        'public_url': "https://" + bucket + ".s3.amazonaws.com/" + key
      };
      return cb(null, put);
    });
  };

  S3Client.prototype._checkDataExtension = function(dataExtension) {
    if (!dataExtension || (this.arrAllowedDataExtensions && indexOf.call(this.arrAllowedDataExtensions, dataExtension) < 0)) {
      return false;
    }
    return mime.lookup(dataExtension);
  };

  S3Client.prototype._checkAllowedDataExtensions = function(arrAllowedDataExtensions) {
    var ext;
    if (!arrAllowedDataExtensions) {
      return false;
    }
    if (!_.isArray(arrAllowedDataExtensions)) {
      throw new Error("Allowed data extensions must be array of strings");
    }
    for (ext in arrAllowedDataExtensions) {
      if (!_.isString(ext)) {
        throw new Error("Extensions must be a strings");
      }
    }
    return true;
  };

  S3Client.prototype._checkOptions = function(options) {
    if (options == null) {
      options = {};
    }
    this.accessKeyId = options.accessKeyId, this.secretAccessKey = options.secretAccessKey, this.region = options.region, this.signatureVersion = options.signatureVersion, this.maxRetries = options.maxRetries, this.maxRedirects = options.maxRedirects, this.systemClockOffset = options.systemClockOffset, this.sslEnabled = options.sslEnabled, this.paramValidation = options.paramValidation, this.computeChecksums = options.computeChecksums, this.convertResponseTypes = options.convertResponseTypes, this.s3ForcePathStyle = options.s3ForcePathStyle, this.s3BucketEndpoint = options.s3BucketEndpoint, this.apiVersion = options.apiVersion, this.httpOptions = options.httpOptions, this.apiVersions = options.apiVersions, this.sessionToken = options.sessionToken, this.credentials = options.credentials, this.credentialProvider = options.credentialProvider, this.logger = options.logger;
    if (!this.accessKeyId) {
      throw new Error("accessKeyId is required");
    }
    if (!this.secretAccessKey) {
      throw new Error("secretAccessKey is required");
    }
    if (!this.region) {
      throw new Error("region is required");
    }
    if (!_.isString(this.accessKeyId)) {
      throw new Error("accessKeyId must be a string");
    }
    if (!_.isString(this.secretAccessKey)) {
      throw new Error("secretAccessKey must be a string");
    }
    if (!_.isString(this.region)) {
      throw new Error("region must be a string");
    }
    if (this.signatureVersion && !_.isString(this.signatureVersion)) {
      throw new Error("signatureVersion must be a string");
    }
    if (this.maxRetries && !_.isInteger(this.maxRetries)) {
      throw new Error('maxRetries must be a integer');
    }
    if (this.maxRedirects && !_.isInteger(this.maxRedirects)) {
      throw new Error('maxRedirects must be a integer');
    }
    if (this.systemClockOffset && !_.isNumber(this.systemClockOffset)) {
      throw new Error('systemClockOffset must be a number');
    }
    if (this.sslEnabled && !_.isBoolean(this.sslEnabled)) {
      throw new Error('sslEnabled must be a boolean');
    }
    if (this.paramValidation && !_.isBoolean(this.paramValidation)) {
      throw new Error('paramValidation must be a boolean');
    }
    if (this.computeChecksums && !_.isBoolean(this.computeChecksums)) {
      throw new Error('computeChecksums must be a boolean');
    }
    if (this.convertResponseTypes && !_.isBoolean(this.convertResponseTypes)) {
      throw new Error('convertResponseTypes must be a boolean');
    }
    if (this.s3ForcePathStyle && !_.isBoolean(this.s3ForcePathStyle)) {
      throw new Error('s3ForcePathStyle must be a boolean');
    }
    if (this.s3BucketEndpoint && !_.isBoolean(this.s3BucketEndpoint)) {
      throw new Error('s3BucketEndpoint must be a boolean');
    }
    if (this.httpOptions && !_.isPlainObject(this.httpOptions)) {
      throw new Error('httpOptions must be a dict with params: proxy, agent, timeout, xhrAsync, xhrWithCredentials');
    }
    if (this.apiVersions && !_.isPlainObject(this.apiVersions)) {
      throw new Error('apiVersions must be a dict with versions');
    }
    if (this.apiVersion && !(_.isString(this.apiVersion || _.isDate(this.apiVersion)))) {
      throw new Error('apiVersion must be a string or date');
    }
    if (this.sessionToken && !this.sessionToken instanceof aws.Credentials) {
      throw new Error('sessionToken must be a AWS.Credentials');
    }
    if (this.credentials && !this.credentials instanceof aws.Credentials) {
      throw new Error('credentials must be a AWS.Credentials');
    }
    if (this.credentialProvider && !this.credentialProvider instanceof aws.CredentialsProviderChain) {
      throw new Error('credentialProvider must be a AWS.CredentialsProviderChain');
    }
    if (this.logger && !(this.logger.write && this.logger.log)) {
      throw new Error('logger must have #write or #log methods');
    }
  };

  return S3Client;

})();

module.exports = S3Client;

//# sourceMappingURL=data:application/json;base64,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LEdBQUcsQ0FBQyxXQUF0RDtBQUNFLFlBQVUsSUFBQSxLQUFBLENBQU0sd0NBQU4sQ0FBVixDQURGO0tBL0RBO0FBa0VBLElBQUEsSUFBRyxJQUFDLENBQUEsV0FBRCxJQUFpQixDQUFBLElBQUssQ0FBQSxXQUFMLFlBQTRCLEdBQUcsQ0FBQyxXQUFwRDtBQUNFLFlBQVUsSUFBQSxLQUFBLENBQU0sdUNBQU4sQ0FBVixDQURGO0tBbEVBO0FBcUVBLElBQUEsSUFBRyxJQUFDLENBQUEsa0JBQUQsSUFBd0IsQ0FBQSxJQUFLLENBQUEsa0JBQUwsWUFBbUMsR0FBRyxDQUFDLHdCQUFsRTtBQUNFLFlBQVUsSUFBQSxLQUFBLENBQU0sMkRBQU4sQ0FBVixDQURGO0tBckVBO0FBd0VBLElBQUEsSUFBRyxJQUFDLENBQUEsTUFBRCxJQUFZLENBQUEsQ0FBSyxJQUFDLENBQUEsTUFBTSxDQUFDLEtBQVIsSUFBa0IsSUFBQyxDQUFBLE1BQU0sQ0FBQyxHQUEzQixDQUFuQjtBQUNFLFlBQVUsSUFBQSxLQUFBLENBQU0seUNBQU4sQ0FBVixDQURGO0tBekVhO0VBQUEsQ0F0S2YsQ0FBQTs7a0JBQUE7O0lBUEYsQ0FBQTs7QUFBQSxNQTJQTSxDQUFDLE9BQVAsR0FBaUIsUUEzUGpCLENBQUEiLCJmaWxlIjoibGliL2luZGV4LmpzIiwic291cmNlUm9vdCI6Ii9zb3VyY2UvIiwic291cmNlc0NvbnRlbnQiOlsiIyBzMy1icm93c2VyLWRpcmVjdC11cGxvYWRcbl8gICAgICAgPSByZXF1aXJlKCdsb2Rhc2gnKVxubWltZSAgICA9IHJlcXVpcmUoJ21pbWUnKVxubW9tZW50ICA9IHJlcXVpcmUoJ21vbWVudCcpXG5jcnlwdG8gID0gcmVxdWlyZSgnY3J5cHRvJylcblxuXG5jbGFzcyBTM0NsaWVudFxuICBjb25zdHJ1Y3RvcjogKG9wdGlvbnMgPSB7fSwgYXJyQWxsb3dlZERhdGFFeHRlbnNpb25zKSAtPlxuICAgIGF3cyA9IHJlcXVpcmUoJ2F3cy1zZGsnKVxuXG4gICAgQF9jaGVja09wdGlvbnMgb3B0aW9ucyB1bmxlc3Mgb3B0aW9ucyBpbnN0YW5jZW9mIGF3cy5Db25maWdcbiAgICBhd3MuY29uZmlnLnVwZGF0ZSBvcHRpb25zXG5cbiAgICBAczMgPSBuZXcgYXdzLlMzKClcblxuICAgIEBhcnJBbGxvd2VkRGF0YUV4dGVuc2lvbnMgPSBudWxsXG4gICAgaWYgYXJyQWxsb3dlZERhdGFFeHRlbnNpb25zIGFuZCBAX2NoZWNrQWxsb3dlZERhdGFFeHRlbnNpb25zIGFyckFsbG93ZWREYXRhRXh0ZW5zaW9uc1xuICAgICAgQGFyckFsbG93ZWREYXRhRXh0ZW5zaW9ucyA9IGFyckFsbG93ZWREYXRhRXh0ZW5zaW9uc1xuXG5cbiAgIyBCcm93c2VyIGZvcm0gcG9zdCBwYXJhbXMgZm9yIHVwbG9hZGluZ1xuICB1cGxvYWRQb3N0Rm9ybTogKG9wdGlvbnMgPSB7fSwgY2IpIC0+XG4gICAgdGhyb3cgbmV3IEVycm9yICdDYWxsYmFjayBpcyByZXF1aXJlZCcgdW5sZXNzIGNiXG4gICAgeyBleHRlbnNpb24sIGtleSwgYnVja2V0LCBleHBpcmVzLCBhY2wsIGNvbnRlbnRMZW5ndGgsIGFsZ29yaXRobSwgcmVnaW9uIH0gPSBvcHRpb25zXG4gICAga2V5ID0gb3B0aW9ucy5rZXlcbiAgICBidWNrZXQgPSBvcHRpb25zLmJ1Y2tldFxuICAgIGV4dGVuc2lvbiA9IG9wdGlvbnMuZXh0ZW5zaW9uID8gbnVsbFxuICAgIGV4cGlyZXMgPSBvcHRpb25zLmV4cGlyZXMgPyBtb21lbnQoKS5hZGQoNjAsICdtaW51dGVzJykudG9EYXRlKClcbiAgICBhY2wgPSBvcHRpb25zLmFjbCA/ICdwdWJsaWMtcmVhZCdcbiAgICBjb250ZW50TGVuZ3RoID0gb3B0aW9ucy5jb250ZW50TGVuZ3RoID8gbnVsbFxuICAgIGFsZ29yaXRobSA9IG9wdGlvbnMuYWxnb3JpdGhtID8gJ0FXUzQtSE1BQy1TSEEyNTYnXG4gICAgcmVnaW9uID0gb3B0aW9ucy5yZWdpb24gPyBAcmVnaW9uXG5cbiAgICAjIEBUT0RPIG9wdGlvbnMgdHlwZSBjaGVja1xuICAgIHVubGVzcyBrZXkgYW5kIGJ1Y2tldFxuICAgICAgcmV0dXJuIGNiIG5ldyBFcnJvciAna2V5IGFuZCBidWNrZXQgYXJlIHJlcXVpcmVkJ1xuXG4gICAgaWYgZXh0ZW5zaW9uXG4gICAgICBjb250ZW50VHlwZSA9IEBfY2hlY2tEYXRhRXh0ZW5zaW9uIGV4dGVuc2lvblxuICAgICAgcmV0dXJuIGNiIG5ldyBFcnJvciAnRGF0YSBleHRlbnNpb24gbm90IGFsbG93ZWQnIHVubGVzcyBjb250ZW50VHlwZVxuXG4gICAgcG9saWN5RG9jID0ge31cblxuICAgIHBvbGljeURvY1tcImV4cGlyYXRpb25cIl0gPSBtb21lbnQoZXhwaXJlcykuZm9ybWF0KFwiWVlZWS1NTS1ERFtUXUhIOk1NOlNTW1pdXCIpIGlmIGV4cGlyZXMgYW5kIF8uaXNEYXRlIGV4cGlyZXNcbiAgICBwb2xpY3lEb2NbXCJjb25kaXRpb25zXCJdID0gW11cblxuICAgIGRhdGVTaG9ydFBvbGljeSA9IG1vbWVudCgpLmZvcm1hdCgnWVlZWU1NREQnKVxuICAgIGRhdGVMb25nUG9saWN5ID0gbW9tZW50KCkuZm9ybWF0KCdZWVlZTU1ERFtUXUhITU1TU1taXScpXG5cbiAgICBwb2xpY3lEb2MuY29uZGl0aW9ucy5wdXNoIHsgJ2J1Y2tldCc6IGJ1Y2tldCB9XG4gICAgcG9saWN5RG9jLmNvbmRpdGlvbnMucHVzaCBbICdzdGFydHMtd2l0aCcsICcka2V5Jywga2V5IF1cbiAgICBwb2xpY3lEb2MuY29uZGl0aW9ucy5wdXNoIHsgJ2FjbCc6IGFjbCB9XG4gICAgcG9saWN5RG9jLmNvbmRpdGlvbnMucHVzaCBbICdzdGFydHMtd2l0aCcsICckQ29udGVudC1UeXBlJywgY29udGVudFR5cGUgXSBpZiBjb250ZW50VHlwZVxuICAgIHBvbGljeURvYy5jb25kaXRpb25zLnB1c2ggWyAnY29udGVudC1sZW5ndGgtcmFuZ2UnLCAwLCBjb250ZW50TGVuZ3RoIF0gaWYgY29udGVudExlbmd0aFxuICAgIHBvbGljeURvYy5jb25kaXRpb25zLnB1c2ggeyBcIngtYW16LWFsZ29yaXRobVwiOiBhbGdvcml0aG0gfVxuICAgIHBvbGljeURvYy5jb25kaXRpb25zLnB1c2ggeyBcIngtYW16LWNyZWRlbnRpYWxcIjogXCIje0BhY2Nlc3NLZXlJZH0vI3tkYXRlU2hvcnRQb2xpY3l9LyN7cmVnaW9ufS9zMy9hd3M0X3JlcXVlc3RcIiB9XG4gICAgcG9saWN5RG9jLmNvbmRpdGlvbnMucHVzaCB7IFwieC1hbXotZGF0ZVwiOiBkYXRlTG9uZ1BvbGljeX1cblxuICAgIGRhdGVLZXkgPSBjcnlwdG8uY3JlYXRlSG1hYygnc2hhMjU2JywgXCJBV1M0I3tAc2VjcmV0QWNjZXNzS2V5fVwiKS51cGRhdGUoZGF0ZVNob3J0UG9saWN5KS5kaWdlc3QoKVxuICAgIGRhdGVSZWdpb25LZXkgPSBjcnlwdG8uY3JlYXRlSG1hYygnc2hhMjU2JywgZGF0ZUtleSkudXBkYXRlKHJlZ2lvbikuZGlnZXN0KClcbiAgICBkYXRlUmVnaW9uU2VydmljZUtleSA9IGNyeXB0by5jcmVhdGVIbWFjKCdzaGEyNTYnLCBkYXRlUmVnaW9uS2V5KS51cGRhdGUoJ3MzJykuZGlnZXN0KClcbiAgICBzaWduaW5nS2V5ID0gY3J5cHRvLmNyZWF0ZUhtYWMoJ3NoYTI1NicsIGRhdGVSZWdpb25TZXJ2aWNlS2V5KS51cGRhdGUoJ2F3czRfcmVxdWVzdCcpLmRpZ2VzdCgpXG4gICAgcG9saWN5ID0gbmV3IEJ1ZmZlcihKU09OLnN0cmluZ2lmeShwb2xpY3lEb2MpKS50b1N0cmluZygnYmFzZTY0JylcbiAgICBzaWduYXR1cmUgPSBjcnlwdG8uY3JlYXRlSG1hYygnc2hhMjU2JyxzaWduaW5nS2V5KS51cGRhdGUocG9saWN5KS5kaWdlc3QoJ2hleCcpXG5cbiAgICBzdHJlYW0gPSB7fVxuICAgIHN0cmVhbVsncGFyYW1zJ10gPVxuICAgICAgXCJrZXlcIjoga2V5XG4gICAgICBcImFjbFwiOiBhY2xcbiAgICAgIFwieC1hbXotYWxnb3JpdGhtXCI6IGFsZ29yaXRobVxuICAgICAgXCJ4LWFtei1jcmVkZW50aWFsXCI6IFwiI3tAYWNjZXNzS2V5SWR9LyN7ZGF0ZVNob3J0UG9saWN5fS8je3JlZ2lvbn0vczMvYXdzNF9yZXF1ZXN0XCJcbiAgICAgIFwieC1hbXotZGF0ZVwiOiBkYXRlTG9uZ1BvbGljeVxuICAgICAgXCJwb2xpY3lcIjogcG9saWN5XG4gICAgICBcIngtYW16LXNpZ25hdHVyZVwiOiBzaWduYXR1cmVcbiAgICBzdHJlYW0ucGFyYW1zWydjb250ZW50LXR5cGUnXSA9IGNvbnRlbnRUeXBlIGlmIGNvbnRlbnRUeXBlXG4gICAgc3RyZWFtWydwdWJsaWNfdXJsJ10gPSBcImh0dHBzOi8vI3tidWNrZXR9LnMzLmFtYXpvbmF3cy5jb20vI3trZXl9XCJcbiAgICBzdHJlYW1bJ2Zvcm1fdXJsJ10gPSBcImh0dHBzOi8vI3tidWNrZXR9LnMzLmFtYXpvbmF3cy5jb20vXCJcblxuICAgIGNiIG51bGwsIHN0cmVhbVxuXG5cbiAgIyBTMy51cGxvYWRcbiAgdXBsb2FkOiAob3B0aW9ucyA9IHt9LCBjYikgLT5cbiAgICB0aHJvdyBuZXcgRXJyb3IgJ0NhbGxiYWNrIGlzIHJlcXVpcmVkJyB1bmxlc3MgY2JcbiAgICB7IGRhdGEsIGV4dGVuc2lvbiwga2V5LCBidWNrZXQsIGV4cGlyZXMsIGFjbCwgY29udGVudExlbmd0aCB9ID0gb3B0aW9uc1xuICAgIGRhdGEgPSBvcHRpb25zLmRhdGFcbiAgICBrZXkgPSBvcHRpb25zLmtleVxuICAgIGJ1Y2tldCA9IG9wdGlvbnMuYnVja2V0XG4gICAgZXh0ZW5zaW9uID0gb3B0aW9ucy5leHRlbnNpb24gPyBudWxsXG4gICAgZXhwaXJlcyA9IG9wdGlvbnMuZXhwaXJlcyA/IG51bGxcbiAgICBhY2wgPSBvcHRpb25zLmFjbCA/IG51bGxcbiAgICBjb250ZW50TGVuZ3RoID0gb3B0aW9ucy5jb250ZW50TGVuZ3RoID8gbnVsbFxuICAgIFxuICAgICMgQFRPRE8gb3B0aW9ucyB0eXBlIGNoZWNrXG4gICAgdW5sZXNzIGRhdGEgYW5kIGtleSBhbmQgYnVja2V0XG4gICAgICByZXR1cm4gY2IgbmV3IEVycm9yICdkYXRhLCBrZXkgYW5kIGJ1Y2tldCBhcmUgcmVxdWlyZWQnXG5cbiAgICBwYXJhbXMgPVxuICAgICAgQnVja2V0OiBidWNrZXRcbiAgICAgIEtleToga2V5XG4gICAgICBCb2R5OiBkYXRhXG5cbiAgICBpZiBleHRlbnNpb25cbiAgICAgIGNvbnRlbnRUeXBlID0gQF9jaGVja0RhdGFFeHRlbnNpb24gZXh0ZW5zaW9uXG4gICAgICByZXR1cm4gY2IgbmV3IEVycm9yICdEYXRhIGV4dGVuc2lvbiBub3QgYWxsb3dlZCcgdW5sZXNzIGNvbnRlbnRUeXBlXG4gICAgICBwYXJhbXNbXCJDb250ZW50VHlwZVwiXSA9IGNvbnRlbnRUeXBlXG5cbiAgICBwYXJhbXNbXCJFeHBpcmVzXCJdID0gbW9tZW50KGV4cGlyZXMpIGlmIGV4cGlyZXMgYW5kIF8uaXNEYXRlIGV4cGlyZXNcbiAgICBwYXJhbXNbXCJBQ0xcIl0gPSBhY2wgaWYgYWNsXG4gICAgcGFyYW1zW1wiQ29udGVudExlbmd0aFwiXSA9IGNvbnRlbnRMZW5ndGggaWYgY29udGVudExlbmd0aFxuXG4gICAgQHMzLnVwbG9hZCBwYXJhbXMsIChlcnIsIGRhdGEpIC0+XG4gICAgICByZXR1cm4gY2IgZXJyIGlmIGVyclxuICAgICAgY2IgbnVsbCwgXCJodHRwczovLyN7YnVja2V0fS5zMy5hbWF6b25hd3MuY29tLyN7a2V5fVwiXG5cblxuICAjIFMzLnB1dE9iamVjdFxuICBwdXQ6IChvcHRpb25zID0ge30sIGNiKSAtPlxuICAgIHRocm93IG5ldyBFcnJvciAnQ2FsbGJhY2sgaXMgcmVxdWlyZWQnIHVubGVzcyBjYlxuICAgIHsgZXh0ZW5zaW9uLCBrZXksIGJ1Y2tldCwgZXhwaXJlcywgYWNsLCBjb250ZW50TGVuZ3RoIH0gPSBvcHRpb25zXG4gICAga2V5ID0gb3B0aW9ucy5rZXlcbiAgICBidWNrZXQgPSBvcHRpb25zLmJ1Y2tldFxuICAgIGV4dGVuc2lvbiA9IG9wdGlvbnMuZXh0ZW5zaW9uID8gbnVsbFxuICAgIGV4cGlyZXMgPSBvcHRpb25zLmV4cGlyZXMgPyBudWxsXG4gICAgYWNsID0gb3B0aW9ucy5hY2wgPyBudWxsXG5cbiAgICAjIEBUT0RPIG9wdGlvbnMgdHlwZSBjaGVja1xuICAgIHVubGVzcyBrZXkgYW5kIGJ1Y2tldFxuICAgICAgcmV0dXJuIGNiIG5ldyBFcnJvciAna2V5IGFuZCBidWNrZXQgYXJlIHJlcXVpcmVkJ1xuXG4gICAgcGFyYW1zID1cbiAgICAgIEJ1Y2tldDogYnVja2V0XG4gICAgICBLZXk6IGtleVxuXG4gICAgaWYgZXh0ZW5zaW9uXG4gICAgICBjb250ZW50VHlwZSA9IEBfY2hlY2tEYXRhRXh0ZW5zaW9uIGV4dGVuc2lvblxuICAgICAgcmV0dXJuIGNiIG5ldyBFcnJvciAnRGF0YSBleHRlbnNpb24gbm90IGFsbG93ZWQnIHVubGVzcyBjb250ZW50VHlwZVxuICAgICAgcGFyYW1zW1wiQ29udGVudFR5cGVcIl0gPSBjb250ZW50VHlwZVxuXG4gICAgcGFyYW1zW1wiRXhwaXJlc1wiXSA9IG1vbWVudChleHBpcmVzKSBpZiBleHBpcmVzIGFuZCBfLmlzRGF0ZSBleHBpcmVzXG4gICAgcGFyYW1zW1wiQUNMXCJdID0gYWNsIGlmIGFjbFxuXG4gICAgQHMzLmdldFNpZ25lZFVybCBcInB1dE9iamVjdFwiLCBwYXJhbXMsIChlcnIsIGRhdGEpIC0+XG4gICAgICByZXR1cm4gY2IgZXJyIGlmIGVyclxuXG4gICAgICBwdXQgPVxuICAgICAgICAnc2lnbmVkX3VybCc6IGRhdGFcbiAgICAgICAgJ3B1YmxpY191cmwnOiBcImh0dHBzOi8vI3tidWNrZXR9LnMzLmFtYXpvbmF3cy5jb20vI3trZXl9XCJcblxuICAgICAgY2IgbnVsbCwgcHV0XG5cblxuICAjIENoZWNrIGRhdGEgdHlwZSBmcm9tIGFyckFsbG93ZWREYXRhRXh0ZW5zaW9uc1xuICBfY2hlY2tEYXRhRXh0ZW5zaW9uOiAoZGF0YUV4dGVuc2lvbikgLT5cbiAgICByZXR1cm4gZmFsc2UgaWYgbm90IGRhdGFFeHRlbnNpb24gb3IgKEBhcnJBbGxvd2VkRGF0YUV4dGVuc2lvbnMgYW5kIGRhdGFFeHRlbnNpb24gbm90IGluIEBhcnJBbGxvd2VkRGF0YUV4dGVuc2lvbnMpXG4gICAgcmV0dXJuIG1pbWUubG9va3VwIGRhdGFFeHRlbnNpb25cblxuXG4gICMgQ2hlY2sgYWxsb3dlZCBkYXRhIHR5cGVzXG4gIF9jaGVja0FsbG93ZWREYXRhRXh0ZW5zaW9uczogKGFyckFsbG93ZWREYXRhRXh0ZW5zaW9ucykgLT5cbiAgICByZXR1cm4gZmFsc2UgdW5sZXNzIGFyckFsbG93ZWREYXRhRXh0ZW5zaW9uc1xuXG4gICAgdW5sZXNzIF8uaXNBcnJheSBhcnJBbGxvd2VkRGF0YUV4dGVuc2lvbnNcbiAgICAgIHRocm93IG5ldyBFcnJvciBcIkFsbG93ZWQgZGF0YSBleHRlbnNpb25zIG11c3QgYmUgYXJyYXkgb2Ygc3RyaW5nc1wiXG5cbiAgICBmb3IgZXh0IG9mIGFyckFsbG93ZWREYXRhRXh0ZW5zaW9uc1xuICAgICAgdW5sZXNzIF8uaXNTdHJpbmcgZXh0XG4gICAgICAgIHRocm93IG5ldyBFcnJvciBcIkV4dGVuc2lvbnMgbXVzdCBiZSBhIHN0cmluZ3NcIlxuXG4gICAgcmV0dXJuIHRydWVcblxuXG4gICMgQ2hlY2sgb3B0aW9ucyBwYXJhbXNcbiAgX2NoZWNrT3B0aW9uczogKG9wdGlvbnMgPSB7fSkgLT5cbiAgICB7XG4gICAgICBAYWNjZXNzS2V5SWQsIEBzZWNyZXRBY2Nlc3NLZXksIEByZWdpb24sIEBzaWduYXR1cmVWZXJzaW9uLCBAbWF4UmV0cmllcywgQG1heFJlZGlyZWN0cywgQHN5c3RlbUNsb2NrT2Zmc2V0LFxuICAgICAgQHNzbEVuYWJsZWQsIEBwYXJhbVZhbGlkYXRpb24sIEBjb21wdXRlQ2hlY2tzdW1zLCBAY29udmVydFJlc3BvbnNlVHlwZXMsIEBzM0ZvcmNlUGF0aFN0eWxlLCBAczNCdWNrZXRFbmRwb2ludCxcbiAgICAgIEBhcGlWZXJzaW9uLCBAaHR0cE9wdGlvbnMsIEBhcGlWZXJzaW9ucywgQHNlc3Npb25Ub2tlbiwgQGNyZWRlbnRpYWxzLCBAY3JlZGVudGlhbFByb3ZpZGVyLCBAbG9nZ2VyXG4gICAgfSA9IG9wdGlvbnNcblxuICAgIHVubGVzcyBAYWNjZXNzS2V5SWRcbiAgICAgIHRocm93IG5ldyBFcnJvciBcImFjY2Vzc0tleUlkIGlzIHJlcXVpcmVkXCJcblxuICAgIHVubGVzcyBAc2VjcmV0QWNjZXNzS2V5XG4gICAgICB0aHJvdyBuZXcgRXJyb3IgXCJzZWNyZXRBY2Nlc3NLZXkgaXMgcmVxdWlyZWRcIlxuXG4gICAgdW5sZXNzIEByZWdpb25cbiAgICAgIHRocm93IG5ldyBFcnJvciBcInJlZ2lvbiBpcyByZXF1aXJlZFwiXG5cbiAgICB1bmxlc3MgXy5pc1N0cmluZyBAYWNjZXNzS2V5SWRcbiAgICAgIHRocm93IG5ldyBFcnJvciBcImFjY2Vzc0tleUlkIG11c3QgYmUgYSBzdHJpbmdcIlxuXG4gICAgdW5sZXNzIF8uaXNTdHJpbmcgQHNlY3JldEFjY2Vzc0tleVxuICAgICAgdGhyb3cgbmV3IEVycm9yIFwic2VjcmV0QWNjZXNzS2V5IG11c3QgYmUgYSBzdHJpbmdcIlxuXG4gICAgdW5sZXNzIF8uaXNTdHJpbmcgQHJlZ2lvblxuICAgICAgdGhyb3cgbmV3IEVycm9yIFwicmVnaW9uIG11c3QgYmUgYSBzdHJpbmdcIlxuXG4gICAgaWYgQHNpZ25hdHVyZVZlcnNpb24gYW5kIG5vdCBfLmlzU3RyaW5nIEBzaWduYXR1cmVWZXJzaW9uXG4gICAgICB0aHJvdyBuZXcgRXJyb3IgXCJzaWduYXR1cmVWZXJzaW9uIG11c3QgYmUgYSBzdHJpbmdcIlxuXG4gICAgaWYgQG1heFJldHJpZXMgYW5kIG5vdCBfLmlzSW50ZWdlciBAbWF4UmV0cmllc1xuICAgICAgdGhyb3cgbmV3IEVycm9yICdtYXhSZXRyaWVzIG11c3QgYmUgYSBpbnRlZ2VyJ1xuXG4gICAgaWYgQG1heFJlZGlyZWN0cyBhbmQgbm90IF8uaXNJbnRlZ2VyIEBtYXhSZWRpcmVjdHNcbiAgICAgIHRocm93IG5ldyBFcnJvciAnbWF4UmVkaXJlY3RzIG11c3QgYmUgYSBpbnRlZ2VyJ1xuXG4gICAgaWYgQHN5c3RlbUNsb2NrT2Zmc2V0IGFuZCBub3QgXy5pc051bWJlciBAc3lzdGVtQ2xvY2tPZmZzZXRcbiAgICAgIHRocm93IG5ldyBFcnJvciAnc3lzdGVtQ2xvY2tPZmZzZXQgbXVzdCBiZSBhIG51bWJlcidcblxuICAgIGlmIEBzc2xFbmFibGVkIGFuZCBub3QgXy5pc0Jvb2xlYW4gQHNzbEVuYWJsZWRcbiAgICAgIHRocm93IG5ldyBFcnJvciAnc3NsRW5hYmxlZCBtdXN0IGJlIGEgYm9vbGVhbidcblxuICAgIGlmIEBwYXJhbVZhbGlkYXRpb24gYW5kIG5vdCBfLmlzQm9vbGVhbiBAcGFyYW1WYWxpZGF0aW9uXG4gICAgICB0aHJvdyBuZXcgRXJyb3IgJ3BhcmFtVmFsaWRhdGlvbiBtdXN0IGJlIGEgYm9vbGVhbidcblxuICAgIGlmIEBjb21wdXRlQ2hlY2tzdW1zIGFuZCBub3QgXy5pc0Jvb2xlYW4gQGNvbXB1dGVDaGVja3N1bXNcbiAgICAgIHRocm93IG5ldyBFcnJvciAnY29tcHV0ZUNoZWNrc3VtcyBtdXN0IGJlIGEgYm9vbGVhbidcblxuICAgIGlmIEBjb252ZXJ0UmVzcG9uc2VUeXBlcyBhbmQgbm90IF8uaXNCb29sZWFuIEBjb252ZXJ0UmVzcG9uc2VUeXBlc1xuICAgICAgdGhyb3cgbmV3IEVycm9yICdjb252ZXJ0UmVzcG9uc2VUeXBlcyBtdXN0IGJlIGEgYm9vbGVhbidcblxuICAgIGlmIEBzM0ZvcmNlUGF0aFN0eWxlIGFuZCBub3QgXy5pc0Jvb2xlYW4gQHMzRm9yY2VQYXRoU3R5bGVcbiAgICAgIHRocm93IG5ldyBFcnJvciAnczNGb3JjZVBhdGhTdHlsZSBtdXN0IGJlIGEgYm9vbGVhbidcblxuICAgIGlmIEBzM0J1Y2tldEVuZHBvaW50IGFuZCBub3QgXy5pc0Jvb2xlYW4gQHMzQnVja2V0RW5kcG9pbnRcbiAgICAgIHRocm93IG5ldyBFcnJvciAnczNCdWNrZXRFbmRwb2ludCBtdXN0IGJlIGEgYm9vbGVhbidcblxuICAgIGlmIEBodHRwT3B0aW9ucyBhbmQgbm90IF8uaXNQbGFpbk9iamVjdCBAaHR0cE9wdGlvbnNcbiAgICAgIHRocm93IG5ldyBFcnJvciAnaHR0cE9wdGlvbnMgbXVzdCBiZSBhIGRpY3Qgd2l0aCBwYXJhbXM6IHByb3h5LCBhZ2VudCwgdGltZW91dCwgeGhyQXN5bmMsIHhocldpdGhDcmVkZW50aWFscydcblxuICAgIGlmIEBhcGlWZXJzaW9ucyBhbmQgbm90IF8uaXNQbGFpbk9iamVjdCBAYXBpVmVyc2lvbnNcbiAgICAgIHRocm93IG5ldyBFcnJvciAnYXBpVmVyc2lvbnMgbXVzdCBiZSBhIGRpY3Qgd2l0aCB2ZXJzaW9ucydcblxuICAgIGlmIEBhcGlWZXJzaW9uIGFuZCBub3QgKF8uaXNTdHJpbmcgQGFwaVZlcnNpb24gb3IgXy5pc0RhdGUgQGFwaVZlcnNpb24pXG4gICAgICB0aHJvdyBuZXcgRXJyb3IgJ2FwaVZlcnNpb24gbXVzdCBiZSBhIHN0cmluZyBvciBkYXRlJ1xuXG4gICAgaWYgQHNlc3Npb25Ub2tlbiBhbmQgbm90IEBzZXNzaW9uVG9rZW4gaW5zdGFuY2VvZiBhd3MuQ3JlZGVudGlhbHNcbiAgICAgIHRocm93IG5ldyBFcnJvciAnc2Vzc2lvblRva2VuIG11c3QgYmUgYSBBV1MuQ3JlZGVudGlhbHMnXG5cbiAgICBpZiBAY3JlZGVudGlhbHMgYW5kIG5vdCBAY3JlZGVudGlhbHMgaW5zdGFuY2VvZiBhd3MuQ3JlZGVudGlhbHNcbiAgICAgIHRocm93IG5ldyBFcnJvciAnY3JlZGVudGlhbHMgbXVzdCBiZSBhIEFXUy5DcmVkZW50aWFscydcblxuICAgIGlmIEBjcmVkZW50aWFsUHJvdmlkZXIgYW5kIG5vdCBAY3JlZGVudGlhbFByb3ZpZGVyIGluc3RhbmNlb2YgYXdzLkNyZWRlbnRpYWxzUHJvdmlkZXJDaGFpblxuICAgICAgdGhyb3cgbmV3IEVycm9yICdjcmVkZW50aWFsUHJvdmlkZXIgbXVzdCBiZSBhIEFXUy5DcmVkZW50aWFsc1Byb3ZpZGVyQ2hhaW4nXG5cbiAgICBpZiBAbG9nZ2VyIGFuZCBub3QgKEBsb2dnZXIud3JpdGUgYW5kIEBsb2dnZXIubG9nKVxuICAgICAgdGhyb3cgbmV3IEVycm9yICdsb2dnZXIgbXVzdCBoYXZlICN3cml0ZSBvciAjbG9nIG1ldGhvZHMnXG5cblxuIyBFeHBvcnRzXG5tb2R1bGUuZXhwb3J0cyA9IFMzQ2xpZW50XG5cbiJdfQ==